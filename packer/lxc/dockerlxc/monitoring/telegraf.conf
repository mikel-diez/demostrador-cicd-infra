# Global Agent Configuration
[agent]
  hostname = "$PROXMOX_HOST"
  flush_interval = "15s"
  interval = "15s"

# Output Configuration for InfluxDB 2.x
[[outputs.influxdb_v2]]
  urls = ["$INFLUXDB_URL"]
  token = "$INFLUXDB_TOKEN"
  organization = "$INFLUXDB_ORG"
  bucket = "$INFLUXDB_BUCKET"

# Input Plugins
# Collect system-level metrics
[[inputs.cpu]]
  percpu = true
  totalcpu = true
  collect_cpu_time = false
  report_active = false

[[inputs.disk]]
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]

[[inputs.diskio]]

[[inputs.mem]]

[[inputs.net]]

[[inputs.processes]]

[[inputs.swap]]

[[inputs.system]]

# Proxmox API Input Plugin (using HTTP)
[[inputs.http]]
  urls = ["https://$PROXMOX_HOST:8006/api2/json/nodes"]
  method = "GET"
  headers = {"Authorization" = "PVEAPIToken=$PROXMOX_USER!$PROXMOX_TOKEN_ID=$PROXMOX_TOKEN_SECRET"}
  data_format = "json"
  insecure_skip_verify = true
  interval = "60s"
  name_override = "proxmox_nodes"
  
[[inputs.http]]
  urls = ["https://$PROXMOX_HOST:8006/api2/json/cluster/resources"]
  method = "GET"
  headers = {"Authorization" = "PVEAPIToken=$PROXMOX_USER!$PROXMOX_TOKEN_ID=$PROXMOX_TOKEN_SECRET"}
  data_format = "json"
  insecure_skip_verify = true
  interval = "60s"
  name_override = "proxmox_resources" 